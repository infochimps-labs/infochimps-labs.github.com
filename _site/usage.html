<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>mrflip.github.com/edamame - MIT License</title>
   <meta name="author"      content="mrflip" />
   <meta name="viewport"    content="width=940" />
   <meta name="keywords"    content=",edamame,beanstalk,beanstalkd,ruby,mrflip,infochimps,persistent,database,queue,queuing,system,sqs,rabbitmq,rails,job,distributed,tokyo,tyrant,cabinet,ruby,gem"/>
   <meta name="description" content="Beanstalk + Tokyo Tyrant = Edamame, a fast persistent distributed priority job queue implemented in Ruby."/>
   <!-- <link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/mrflip-github-com-edamame" title="mrflip/edamame" /> -->
   <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="mrflip/edamame" />
   <link rel="shortcut icon"              href="/favicon.ico" />
   <!--[if IE]>
   <link rel="stylesheet" type="text/css" href="/css/ie.css"     media="screen, projection" />
   <![endif]-->
   <link rel="stylesheet" type="text/css" href="/css/print.css"  media="print" />
   <link rel="stylesheet" type="text/css" href="/css/main.css"   media="screen, projection" />
   <link rel="stylesheet" type="text/css" href="/css/syntax.css" />
</head>
<body>

<div id="container">
  <div id="header">
    <a href="/">mrflip/edamame</a>
    &middot; <a class="extra" href="http://github.com/mrflip/edamame">source code</a>
    
    &middot; <a class="extra" href="/INSTALL.html">install</a>
    
    &middot; <a class="extra" href="/LICENSE.html">license</a>
    
    &middot; <a class="extra" href="/usage.html">usage</a>
    
    &middot; <a class="extra" href="/alternatives.html">alternatives</a>
    
  </div>

  <div class="download"><a href="http://github.com/mrflip/edamame/zipball/master"><img border="0" width="72" src="/images/zip.png"></a><a href="http://github.com/mrflip/edamame/tarball/master"><img border="0" width="72" src="/images/tar.png"></a><a href="http://gems.github.com/gems/mrflip-edamame-0.1.0.gem"><img border="0" width="72" src="/images/gem.png"></a></div>
  <h1 class="gemheader">edamame <span class="small">:: usage</span></h1>
<div class="toggle">
<h2>Design</h2>
<p>Jobs are persisted to a tokyo tyrant backing store. Beanstalkd</p>
<p>(No failover or discovery, but yes restarting and reloading.)</p>
</div>
<div class="toggle">
<h2>Caveats</h2>
<p>Weaknesses? Mainly that it will make an Erlang&#8217;er cry for its lack of concurrency correctness. Its goal is to work pretty well and to recover gracefully, but its design limits .</p>
<ul>
	<li>We store jobs in two places: the central DB and the distributed queue.</li>
</ul>
<ul>
	<li>As always, your jobs must either be idempotent, or harmless if re-run: a job could start and do some or all of its job &#8212; but lose contact with the queue, causing the job to be re-run. This is inherent in beanstalkd (and most comparable solutions), not just edamame.</li>
</ul>
<ul>
	<li>Although God</li>
</ul>
</div>
<div class="toggle">
<h2>TODOs</h2>
<ul>
	<li>Restarting is still manual: you have to run bin/sync.rb to reload the queue from the database</li>
	<li>Right now each jobs lives in full in the beanstalkd. This carries a heavy memory cost but a performance gain (the alternative is to do a second query to the DB once the job has been retrieved). I&#8217;m going to make both implementations available.</li>
	<li>The sinatra queue viewer doesn&#8217;t work at the moment.</li>
	<li>Tests :-/</li>
</ul>
</div>
<div class="toggle">
<h2>Note on Patches/Pull Requests</h2>
<ul>
	<li>Fork the project.</li>
	<li>Make your feature addition or bug fix.</li>
	<li>Add tests for it. This is important so I don&#8217;t break it in a future version unintentionally.</li>
	<li>Commit, do not mess with rakefile, version, or history. (if you want to have your own version, that is fine but  bump version in a commit by itself I can ignore when I pull)</li>
	<li>Send me a pull request. Bonus points for topic branches.</li>
</ul>
</div>
<div class="toggle">
<h2>Endnotes</h2>
<ul>
	<li>If it&#8217;s not obvious: beanstalk + tokyo = <a href="http://en.wikipedia.org/wiki/Edamame">edamame,</a> a tasty Japanese appetizer.</li>
	<li>You might enjoy the <a href="http://bit.ly/shines">Monkeyshines</a> distributed <span class="caps"><span class="caps">API</span></span> scraper, which this library was written to support.</li>
	<li>Beanstalk:<br />
	<ul><br />
		<li><a href="http://xph.us/software/beanstalkd/">Beanstalk, a fast, distributed, in-memory workqueue service</a></li>
		<li><a href="http://github.com/kr/beanstalkd/tree/master">Beanstalkd code</a></li>
		<li><a href="http://wiki.github.com/kr/beanstalkd/faq"><span class="caps"><span class="caps">FAQ</span></span></a></li>
		<li><a href="http://github.com/dustin/beanstalk-client-ruby/tree/master">Beanstalk Ruby Client</a></li>
		<li><a href="http://nubyonrails.com/articles/about-this-blog-beanstalk-messaging-queue">Tutorial from nubyonrails</a></li>
		<li><a href="http://www.mail-archive.com/beanstalk-talk@googlegroups.com/">Mailing list</a></li>
		<li>Some <a href="http://github.com/dustin/beanstalk-tools/tree/master">beanstalk utilities</a> &#8212; edamame has its own take on some of these.</li>
<p></ul></li></p>
</ul>
<ul>
	<li>Tokyo Tyrant:<br />
	<ul><br />
		<li><a href="http://tokyocabinet.sourceforge.net/tyrantdoc/">Tokyo Tyrant</a></li>
		<li><a href="http://tokyocabinet.sourceforge.net/tyrantrubydoc/">Tokyo Tyrant Ruby libs</a></li>
		<li>You&#8217;ll need the <a href="http://tokyocabinet.sourceforge.net">Tokyo Cabinet</a> libs and the <a href="http://tokyocabinet.sourceforge.net/tyrantdoc/">Tokyo Cabinet Ruby libs</a></li>
<p></ul></li></p>
</ul>
<ul>
	<li><a href="http://god.rubyforge.org/">God process monitoring framework</a><br />
	<ul><br />
		<li>http://railscasts.com/episodes/130-monitoring-with-god</li>
		<li>Some code for the god conf is inspired by that railscast, <a href="http://pastie.textmate.org/private/ovgxu2ihoicli2ktrwtbew">this pastie,</a> the <a href="http://god.rubyforge.org/">one from the god docs</a>, and <a href="http://millarian.com/programming/ruby-on-rails/monitoring-thin-using-god-with-google-apps-notifications/">Configuring GMail notifiers in God</a></li>
		<li>Alternatives to God include (in order of complexity): <a href="http://mmonit.com/monit/">Monit,</a> perhaps <a href="http://www.howtoforge.com/server_monitoring_monit_munin">with Munin;</a> <a href="http://www.cacti.net/">Cacti</a> and <a href="http://www.hyperic.com/">Hyperic</a></li>
<p></ul></li></p>
</ul>
</div>

  <br class="clear">
      
  <div id="footer">
    <div class="contact list aligned">
      <p>
      <a href="http://infochimps.org/"   >infochimps.org</a>            | find, share or sell any dataset in the world<br />
      <a href="http://github.com/mrflip/">github/mrflip</a>         | mrflip's code on github.com <br />
      </p>
    </div>
    <div class="contact list aligned">
      <p>
      <a href="http://github.com/mrflip/wukong"       >wukong</a>       | hadoop made easy          <br />
      <a href="http://github.com/mrflip/edamame"      >edamame</a>      | fast persistent job queue <br />
      <a href="http://github.com/mrflip/monkeyshines" >monkeyshines</a> | api scraper               <br />
      <a href="http://github.com/mrflip/wuclan"       >wuclan</a>       | social media scraper
      </p>
    </div>
    <div class="rss">
      <!-- http://feeds.feedburner.com/mrflip-github-com-edamame -->
      <a href="/atom.xml"><img src="/images/rss.png" alt="Subscribe to RSS Feed" /></a> 
    </div>
    <p class="clear">Thanks to <a href="http://github.com/mojombo/">github.com/mojombo</a> for the swanky HTML layout.</p>
  </div>
</div>

<a href="http://github.com/mrflip/edamame"><img style="position: absolute; top: 0; right: 0; border: 0;" src="/images/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"      type="text/javascript" ></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/jquery-ui.min.js" type="text/javascript" ></script>
<script src="/javascripts/application.js"                                          type="text/javascript" ></script>



<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-3828631-3");
pageTracker._trackPageview();
} catch(err) {}</script>

</body>
</html>
